<!doctype html>
<html>
	<style>
		.noblock {
			display:inline;
		}
		
		.blinking-cursor {
			border: 1px solid blue;
			display:inline;
		}
	</style>
	<script>
		function onLoad() {
			keyCodes = {
				BACK_SPACE:8,
				SPACE:32,
				ENTER:13,
				LEFT:37,
				RIGHT:39,
				UP:38,
				DOWN:40,
				END:35,
				HOME:36
			};

			var cursor = new Cursor('blue');
			content = new FileContent(cursor);
			document.onkeypress = keyDownTextField;
			document.onkeydown = specialEvents;
		}
		

		/*
		* cursors
		* recieve color of cursor
		* recieve id of cursor (TODO remove default 'cursor' for debug)
		* recieve x value
		* recieve y value
		* and create div of cursor with blinking class
		*/
		class Cursor {
			constructor(color, id = 'cursor', x = 0, y = 0) {
				this.cursorDiv = '<div id='+id+' class="blinking-cursor" style="border-color: '+color+';"></div>';
				this.id = id;
				this.x = x;
				this.y = y;
			}

			get len() {
				return this.cursorDiv.length;
			}
			
			get getCursorDiv() {
				return this.cursorDiv;
			}

			get getX() {
				return this.x;
			}

			get getY() {
				return this.y;
			}
			
			get getId() {
				return this.id;
			}
			
			setX(x) {
				this.x = x;
			}

			setY(y) {
				this.y = y;
			}
		}

		/*
		* create the content with the cursors implimented in it
		* recieve user cursor
		*/
		class FileContent {
			constructor(cursor) {
				this.content = '' + cursor.getCursorDiv;
				this.corsur = cursor;
			}

			get getContent() {
				return this.content;
			}

			addKey(key) {
				var i = this.content.indexOf(this.corsur.getCursorDiv);
				this.content = this.content.slice(0, i) + key + this.content.slice(i);
			}
			
			backspace() {
				console.log('reached')
				var i = this.content.indexOf(this.corsur.getCursorDiv);
				var length = check_special_string(this.content.slice(0, i))
				this.content = this.content.slice(0, i - length) + this.content.slice(i);
			}
			
			//checks if innerHTML ends with something if end = true
			//checks if innerHTML starts with something if end = false
			check_special_string(content, end = true) {
				if (end) {
					if (content.endsWith('&nbsp;')) {
						length = '&nbsp;'.length;
					} else if (content.endsWith('&amp;')) {
						length = '&amp;'.length;
					} else if (content.endsWith('<br>')) {
						length = '<br>'.length;
					} else {
						length = 1;
					}
				} else {
					if (content.substring(0, '&nbsp;'.length) == '&nbsp;') {
						length = '&nbsp;'.length;
					} else if (content.substring(0, '&amp;'.length) == '&amp;') {
						length = '&amp;'.length;
					} else if (content.substring(0, '<br>'.length) == '<br>') {
						length = '<br>'.length;
					} else {
						length = 1;
					}
				}
			}
		}

		//checks for readable keys
		function keyDownTextField(evt) {
			if (evt) {
				var charCode = (evt.charCode) ? evt.charCode : evt.keyCode;
				key = String.fromCharCode(charCode);
				if (charCode == keyCodes['ENTER']) {
					content.addKey('<br>');
				} else if (charCode == keyCodes['SPACE']) {
					content.addKey('&nbsp;');
				} else {
					content.addKey(key);
				}
			}

			document.getElementById('content').innerHTML = content.getContent;
		}

		//checks for spacial keys
		function specialEvents(evt) {
			if (evt) {
				/*var content = document.getElementById('content');
				var myCursor = '<div id="cursor" class="blinking-cursor" style="border-color: blue;"></div>'
				var i = content.innerHTML.indexOf(myCursor)*/

				if (evt.keyCode == keyCodes['BACK_SPACE']) {
					content.backspace;
				} else if(evt.keyCode == keyCodes['LEFT']) {
					length = check_special_string(head);
					tail.innerHTML = head.innerHTML.slice(-1*length) + tail.innerHTML;
					backSpace(head, length);
				} else if(evt.keyCode == keyCodes['RIGHT']) {
					length = check_special_string(tail, false);
					head.innerHTML += tail.innerHTML.slice(0, length);
					tail.innerHTML = tail.innerHTML.substring(
							length,
							tail.innerHTML.length
						);
				}
				else if(evt.keyCode == keyCodes['END']) {
					loc = tail.innerHTML.indexOf('<br>');
					if (loc == -1) {
						head.innerHTML += tail.innerHTML;
						tail.innerHTML = '';
					} else {
						head.innerHTML += tail.innerHTML.slice(0, loc);
						tail.innerHTML = tail.innerHTML.substring(
							loc,
							tail.innerHTML.length
						);
					}
				} else if(evt.keyCode == keyCodes['HOME']) {
					loc = head.innerHTML.lastIndexOf('<br>');
					if (loc == -1) {
						tail.innerHTML = head.innerHTML + tail.innerHTML;
						head.innerHTML = '';
					} else {
						loc = head.innerHTML.length - loc - '<br>'.length;
						if (loc != 0){
							tail.innerHTML = head.innerHTML.slice(-1*loc) + tail.innerHTML;
							backSpace(head, loc);
						}
					}
				}
			}

			document.getElementById('content').innerHTML = content.getContent;
		}
	</script>
	<body onload='onLoad()'>
		<div id='content' class='noblock'><div id='cursor' class='blinking-cursor'></div></div>
	</body>
</html>