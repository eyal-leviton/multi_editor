<!doctype html>
<html>
	<style>
		.noblock {
			display:inline;
		}
		
		.blinking-cursor {
			border: 1px solid blue;
			display:inline;
		}
	</style>
	<script>
		function onLoad() {
			keyCodes = {
				BACK_SPACE:8,
				SPACE:32,
				ENTER:13,
				LEFT:37,
				RIGHT:39,
				UP:38,
				DOWN:40,
				END:35,
				HOME:36
			};

			cursor = new Cursor('blue');
			content = new FileContent(cursor);
			document.onkeypress = keyDownTextField;
			document.onkeydown = specialEvents;
		}
		

		/*
		* cursors
		* recieve color of cursor
		* recieve id of cursor (TODO remove default 'cursor' for debug)
		* recieve x value
		* recieve y value
		* and create div of cursor with blinking class
		*/
		class Cursor {
			constructor(color, id = 'cursor', x = 0, y = 0) {
				this.cursorDiv = '<div id='+id+' class="blinking-cursor" style="border-color: '+color+';"></div>';
				this.id = id;
				this.x = x;
				this.y = y;
			}

			get getLen() {
				return this.cursorDiv.length;
			}
			
			get getCursorDiv() {
				return this.cursorDiv;
			}

			get getX() {
				return this.x;
			}

			get getY() {
				return this.y;
			}
			
			get getId() {
				return this.id;
			}
			
			setX(x) {
				this.x = x;
			}

			setY(y) {
				this.y = y;
			}
		}

		/*
		* create the content with the cursors implimented in it
		* recieve user cursor
		*/
		class FileContent {
			constructor(cursor) {
				this.content = '' + cursor.getCursorDiv;
				this.cursor = cursor;
			}

			get getContent() {
				return this.content;
			}
			
			get getLen() {
				return this.content.length - this.cursor.getLen;
			}

			addKey(key) {
				var i = this.content.indexOf(this.cursor.getCursorDiv);
				this.content = this.content.slice(0, i) + key + this.content.slice(i);
			}
			
			backspace() {
				var i = this.content.indexOf(this.cursor.getCursorDiv);
				var length = this.check_special_string(this.content.slice(0, i));
				this.content = this.content.slice(0, i - length) + this.content.slice(i);
			}
			
			leftPress() {
				var i = this.content.indexOf(this.cursor.getCursorDiv);
				var length = this.check_special_string(this.content.slice(0, i));
				var tempStr = this.content.slice(i - length, i);
				this.content = this.pushStr(tempStr, i + this.cursor.getLen);
				this.backspace();
			}
			
			rightPress() {
				var i = this.content.indexOf(this.cursor.getCursorDiv) + this.cursor.getLen;
				var length = this.check_special_string(this.content.slice(i), true);
				var tempStr = this.content.slice(i, i + length);
				this.content = this.content.slice(0, i) + this.content.slice(i + length);
				this.content = this.pushStr(tempStr, i - this.cursor.getLen);
			}
			
			//TODO
			endPress() {
				var i = this.content.indexOf(this.cursor.getCursorDiv) + this.cursor.getLen;
				var brLoc = this.content.slice(i).indexOf('<br>');
				if (brLoc == -1) {
					this.content = this.content.slice(0, i - this.cursor.getLen) + this.content.slice(i) + this.cursor.getCursorDiv;
				} else {
					this.content = (this.content.slice(0, i - this.cursor.getLen)
						+ this.content.slice(i, brLoc)
						+ this.cursor.getCursorDiv
						+ this.content.slice(brLoc));
				}
			}
			//checks if innerHTML ends with something if end = true
			//checks if innerHTML starts with something if end = false
			check_special_string(content, checkStart = false) {
				if (!checkStart) {
					if (content.endsWith('&nbsp;')) {
						length = '&nbsp;'.length;
					} else if (content.endsWith('&amp;')) {
						length = '&amp;'.length;
					} else if (content.endsWith('<br>')) {
						length = '<br>'.length;
					} else if (content.length == 0){
						length = 0;
					} else {
						length = 1;
					}
				} else {
					if (content.substring(0, '&nbsp;'.length) == '&nbsp;') {
						length = '&nbsp;'.length;
					} else if (content.substring(0, '&amp;'.length) == '&amp;') {
						length = '&amp;'.length;
					} else if (content.substring(0, '<br>'.length) == '<br>') {
						length = '<br>'.length;
					} else if (content.length == 0){
						length = 0;
					} else {
						length = 1;
					}
				}
				
				return length;
			}
			
			pushStr(str, i) {
				return this.content.slice(0, i) + str + this.content.slice(i);
			}
		}

		//checks for readable keys
		function keyDownTextField(evt) {
			if (evt) {
				var charCode = (evt.charCode) ? evt.charCode : evt.keyCode;
				key = String.fromCharCode(charCode);
				if (charCode == keyCodes['ENTER']) {
					content.addKey('<br>');
				} else if (charCode == keyCodes['SPACE']) {
					content.addKey('&nbsp;');
				} else {
					content.addKey(key);
				}
			}

			document.getElementById('content').innerHTML = content.getContent;
		}

		//checks for spacial keys
		function specialEvents(evt) {
			if (evt) {
				if (evt.keyCode == keyCodes['BACK_SPACE']) {
					content.backspace();
				} else if(evt.keyCode == keyCodes['LEFT']) {
					content.leftPress();
				} else if(evt.keyCode == keyCodes['RIGHT']) {
					content.rightPress();
				}
				else if(evt.keyCode == keyCodes['END']) {
					content.endPress();
				} else if(evt.keyCode == keyCodes['HOME']) {
					loc = head.innerHTML.lastIndexOf('<br>');
					if (loc == -1) {
						tail.innerHTML = head.innerHTML + tail.innerHTML;
						head.innerHTML = '';
					} else {
						loc = head.innerHTML.length - loc - '<br>'.length;
						if (loc != 0){
							tail.innerHTML = head.innerHTML.slice(-1*loc) + tail.innerHTML;
							backSpace(head, loc);
						}
					}
				}
			}

			document.getElementById('content').innerHTML = content.getContent;
		}
	</script>
	<body onload='onLoad()'>
		<div id='content' class='noblock'></div>
	</body>
</html>